<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Mi Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div *ngIf="isLoading" class="ion-text-center ion-padding">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Cargando perfil...</p>
  </div>

  <div *ngIf="!isLoading && errorMessage" class="ion-text-center ion-padding error-message-container">
    <ion-icon name="alert-circle-outline" color="danger" class="error-icon"></ion-icon>
    <p class="error-text">{{ errorMessage }}</p>
    <ion-button (click)="loadUserData(currentUser!.id)" fill="outline" color="primary" class="ion-margin-top">
      Reintentar
    </ion-button>
  </div>

  <div *ngIf="!isLoading && !errorMessage && currentUser">
    <ion-card class="profile-card">
      <ion-card-header>
        <ion-card-title class="ion-text-center">{{ userName }}</ion-card-title>
        <ion-card-subtitle class="ion-text-center">Tu Perfil</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-item lines="none">
          <ion-icon name="mail-outline" slot="start" color="medium"></ion-icon>
          <ion-label>
            <h2>Correo Electrónico</h2>
            <p>{{ userEmail }}</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="key-outline" slot="start" color="medium"></ion-icon>
          <ion-label>
            <h2>Contraseña</h2>
            <p>******** (oculta por seguridad)</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-card class="completed-levels-card ion-margin-top">
      <ion-card-header>
        <ion-card-title>Niveles Completados</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list *ngIf="completedLevels.length > 0; else noCompletedLevels">
          <ion-item *ngFor="let nivel of completedLevels" lines="inset">
            <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>{{ nivel.nombre }}</h3>
              <p *ngIf="nivel.descripcion">{{ nivel.descripcion }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
        <ng-template #noCompletedLevels>
          <p class="ion-text-center ion-padding">Aún no has completado ningún nivel. ¡Sigue aprendiendo!</p>
        </ng-template>
      </ion-card-content>
    </ion-card>

    <ion-button expand="block" color="danger" class="ion-margin-top" (click)="signOut()">
      <ion-icon name="log-out-outline" slot="start"></ion-icon>
      Cerrar Sesión
    </ion-button>
  </div>
</ion-content>

<style>
  .profile-card, .completed-levels-card {
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
  }

  .profile-card ion-card-title {
    font-size: 1.8em;
    font-weight: bold;
    color: var(--ion-color-primary);
  }

  .profile-card ion-card-subtitle {
    color: var(--ion-color-medium);
  }

  .completed-levels-card ion-card-title {
    font-size: 1.4em;
    font-weight: bold;
    color: var(--ion-color-secondary);
  }

  ion-item {
    --padding-start: 10px;
    --inner-padding-end: 10px;
    --background: var(--ion-color-light);
    border-radius: 8px;
    margin-bottom: 8px;
  }

  ion-item ion-icon {
    font-size: 1.5em;
    margin-right: 10px;
  }

  ion-button[color="danger"] {
    --background: var(--ion-color-danger);
    --background-activated: var(--ion-color-danger-shade);
    --background-focused: var(--ion-color-danger-tint);
    --color: #fff;
    --border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  /* Estilos de error */
  .error-message-container {
    background-color: var(--ion-color-danger-tint);
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    border: 1px solid var(--ion-color-danger);
  }

  .error-icon {
    font-size: 3em;
    margin-bottom: 10px;
  }

  .error-text {
    color: var(--ion-color-danger-shade);
    font-weight: bold;
  }
</style>
